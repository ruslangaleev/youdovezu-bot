# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Telegram WebApp API

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è API –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è YouDovezu, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω–µ–µ API –±—ã–ª —É—è–∑–≤–∏–º - –ª—é–±–æ–π –º–æ–≥ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –¥–∞–Ω–Ω—ã–µ:

```http
GET /api/webapp/user/123456789
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–ª–æ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º:
- –ü–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª—é–±–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ü–æ–ª—É—á–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## –†–µ—à–µ–Ω–∏–µ

### 1. Telegram WebApp initData Validation

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–µ—Ä–≤–∏—Å `TelegramWebAppValidationService`, –∫–æ—Ç–æ—Ä—ã–π:

- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å initData** –æ—Ç Telegram WebApp
- **–ò–∑–≤–ª–µ–∫–∞–µ—Ç Telegram ID** –∏–∑ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç HMAC-SHA256** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏

```csharp
public class TelegramWebAppValidationService
{
    public bool ValidateInitData(string initData)
    {
        // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å initData
        // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –±–æ—Ç–∞
    }
    
    public long? ExtractTelegramId(string initData)
    {
        // –ò–∑–≤–ª–µ–∫–∞–µ—Ç Telegram ID –∏–∑ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    }
}
```

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ API Endpoints

–ò–∑–º–µ–Ω–µ–Ω—ã –º–µ—Ç–æ–¥—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:

**–ë—ã–ª–æ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):**
```csharp
[HttpGet("user/{telegramId}")]
public async Task<IActionResult> GetUserInfo(long telegramId)
```

**–°—Ç–∞–ª–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ):**
```csharp
[HttpPost("user")]
public async Task<IActionResult> GetUserInfo([FromForm] string initData)
{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å initData
    if (!_validationService.ValidateInitData(initData))
        return Unauthorized();
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º Telegram ID –∏–∑ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    var telegramId = _validationService.ExtractTelegramId(initData);
}
```

### 3. Frontend Integration

–û–±–Ω–æ–≤–ª–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è initData:

```typescript
const checkUserRegistration = async () => {
  // –ü–æ–ª—É—á–∞–µ–º initData –æ—Ç Telegram WebApp
  let initData = '';
  
  if (window.Telegram?.WebApp?.initData) {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º Telegram WebApp
    initData = window.Telegram.WebApp.initData;
  } else {
    // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    initData = urlParams.get('initData') || 'test_data';
  }

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –∑–∞–ø—Ä–æ—Å —Å initData
  const formData = new FormData();
  formData.append('initData', initData);

  const response = await axios.post('/api/webapp/user', formData);
};
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. Telegram WebApp initData

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram, –±–æ—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

```
user={"id":123456789,"first_name":"John"}&chat_instance=-123456789&auth_date=1234567890&hash=abc123...
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

–°–µ—Ä–≤–µ—Ä:
1. **–ò–∑–≤–ª–µ–∫–∞–µ—Ç hash** –∏–∑ initData
2. **–°–æ–∑–¥–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** –∏–∑ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
3. **–í—ã—á–∏—Å–ª—è–µ—Ç HMAC-SHA256** –æ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
4. **–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç** —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º hash

### 3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü–æ–ª–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–≤–æ–¥–∏—Ç –ø–∞—Ä–æ–ª–∏  
‚úÖ **Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í Telegram WebApp
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç initData –æ—Ç Telegram.

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å initData —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä:
```
http://localhost:3000?initData=test_data
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é

–ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ BotFather:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/setmenubutton`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –£–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏: `üöó YouDovezu`
5. –£–∫–∞–∂–∏—Ç–µ URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `http://localhost:3000` (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `Program.cs`:

```csharp
builder.Services.AddScoped<TelegramWebAppValidationService>(provider =>
{
    var botToken = builder.Configuration["Telegram:BotToken"];
    var logger = provider.GetRequiredService<ILogger<TelegramWebAppValidationService>>();
    return new TelegramWebAppValidationService(botToken, logger);
});
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- **–ó–∞—â–∏—Ç—É –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º Telegram WebApp**
- **–ü—Ä–æ—Å—Ç–æ—Ç—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

–¢–µ–ø–µ—Ä—å API –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–µ–Ω –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
